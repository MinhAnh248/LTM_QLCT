# ğŸš€ Setup Render - HÆ°á»›ng dáº«n tá»«ng bÆ°á»›c

## âœ… BÆ°á»›c 1: WAN Service (ÄÃƒ XONG)
- URL: https://expense-manager-wan.onrender.com
- Status: âœ… Live

## âœ… BÆ°á»›c 1.5: LAN Service (ÄÃƒ XONG)
- URL: https://expense-manager-lan.onrender.com
- Status: âœ… Live

---

## âœ… BÆ°á»›c 2: PostgreSQL Database (ÄÃƒ XONG)
- Name: expense-db
- Status: âœ… Available
- Database: expense_manager_miiy
- Username: expense_user

### âš ï¸ QUAN TRá»ŒNG: Copy Internal Database URL
Trong Render Dashboard â†’ expense-db â†’ **Internal Database URL** (click Ä‘á»ƒ show)
Format: `postgresql://expense_user:password@dpg-xxx-a:5432/expense_manager_miiy`

---

## âœ… BÆ°á»›c 3: LAN Service (ÄÃƒ XONG)

### TrÃªn Render Dashboard:
1. Click **"New +"** â†’ **"Web Service"**
2. Connect GitHub repository: `MinhAnh248/LTM_QLCT`
3. Äiá»n thÃ´ng tin:

```yaml
Name: expense-manager-lan
Environment: Python 3
Region: Singapore
Branch: main

Build Command:
cd LAN && pip install -r requirements.txt

Start Command:
cd LAN && python app.py
```

4. **Environment Variables** - Click "Add Environment Variable":

```bash
# Copy tá»« WAN service (pháº£i giá»‘ng nhau)
INTERNAL_SECRET=<copy-from-WAN>

# Generate má»›i
ADMIN_SECRET=<generate-random-32-chars>

# Copy tá»« PostgreSQL database
DATABASE_URL=<paste-internal-database-url>

# Fixed
FLASK_ENV=production
PORT=10000
```

5. Click **"Create Web Service"**
6. Äá»£i deploy xong (3-5 phÃºt)

---

## âœ… BÆ°á»›c 4: Environment Variables (ÄÃƒ XONG)

### 4.1 WAN Service Settings:
1. VÃ o **expense-manager-wan** â†’ **Environment**
2. ThÃªm/Cáº­p nháº­t:

```bash
# URL cá»§a LAN service
LAN_API_URL=https://expense-manager-lan.onrender.com

# Database URL
DATABASE_URL=postgresql://expense_user:zgZqlwMttXq4M5sDAPilBEBsxMrLNW9L@dpg-d44sll8dl3ps73bjgqqg-a/expense_manager_miiy
```

### 4.2 LAN Service Settings:
1. VÃ o **expense-manager-lan** â†’ **Environment**
2. ThÃªm:

```bash
# Database URL (giá»‘ng WAN)
DATABASE_URL=postgresql://expense_user:zgZqlwMttXq4M5sDAPilBEBsxMrLNW9L@dpg-d44sll8dl3ps73bjgqqg-a/expense_manager_miiy

# Táº¡o ADMIN_SECRET má»›i (32 kÃ½ tá»± random)
ADMIN_SECRET=admin-secret-key-12345678901234567890

# Copy INTERNAL_SECRET tá»« WAN (pháº£i giá»‘ng nhau)
INTERNAL_SECRET=<copy-from-WAN-service>
```

3. Click **"Save Changes"** á»Ÿ cáº£ 2 services
4. Cáº£ 2 services sáº½ tá»± Ä‘á»™ng redeploy

---

## âœ… BÆ°á»›c 5: Khá»Ÿi táº¡o Database (ÄÃƒ XONG)

### Gá»i API khá»Ÿi táº¡o database:

```bash
curl -X POST https://expense-manager-lan.onrender.com/init_db \
  -H "Admin-Secret: admin-secret-key-12345678901234567890"
```

**Káº¿t quáº£ mong Ä‘á»£i:**
```json
{"success": true, "message": "Database initialized"}
```

**Náº¿u lá»—i:** Äá»£i 1-2 phÃºt Ä‘á»ƒ services redeploy xong rá»“i thá»­ láº¡i.

---

## âœ… BÆ°á»›c 6: Test há»‡ thá»‘ng

### Test 1: Health checks
```bash
# WAN
curl https://expense-manager-wan.onrender.com/health

# LAN
curl https://expense-manager-lan.onrender.com/health
```

### Test 2: ÄÄƒng kÃ½ user
```bash
curl -X POST https://expense-manager-wan.onrender.com/register \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "123456"}'
```

### Test 3: ÄÄƒng nháº­p
```bash
curl -X POST https://expense-manager-wan.onrender.com/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "123456"}'
```

### Test 4: Truy cáº­p web
Má»Ÿ browser: https://expense-manager-wan.onrender.com

---

## ğŸ“‹ Checklist hoÃ n thÃ nh

- [x] WAN Service deployed
- [x] LAN Service deployed
- [x] PostgreSQL Database created
- [x] Environment variables configured
- [x] Database initialized
- [ ] System tested ğŸ‘† **TIáº¾P THEO**

---

## ğŸ”‘ Environment Variables Summary

### WAN Service:
```bash
FLASK_ENV=production
SECRET_KEY=<auto-generated>
INTERNAL_SECRET=<must-match-LAN>
LAN_API_URL=https://expense-manager-lan.onrender.com
DATABASE_URL=<from-postgres>
```

### LAN Service:
```bash
FLASK_ENV=production
INTERNAL_SECRET=<must-match-WAN>
ADMIN_SECRET=<generate-new>
DATABASE_URL=<from-postgres>
PORT=10000
```

---

## ğŸš¨ Troubleshooting

### LAN khÃ´ng start Ä‘Æ°á»£c:
- Kiá»ƒm tra DATABASE_URL Ä‘Ãºng format
- Kiá»ƒm tra requirements.txt cÃ³ psycopg2-binary
- Xem logs: LAN service â†’ Logs tab

### WAN khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c LAN:
- Kiá»ƒm tra LAN_API_URL Ä‘Ãºng
- Kiá»ƒm tra INTERNAL_SECRET giá»‘ng nhau
- Test LAN health: `curl https://expense-manager-lan.onrender.com/health`

### Database connection error:
- Kiá»ƒm tra DATABASE_URL format: `postgresql://user:pass@host:5432/db`
- Äáº£m báº£o dÃ¹ng Internal Database URL (khÃ´ng pháº£i External)
- Kiá»ƒm tra database Ä‘Ã£ khá»Ÿi táº¡o xong

---

## ğŸ‰ Káº¿t quáº£

Sau khi hoÃ n thÃ nh:
- **WAN**: https://expense-manager-wan.onrender.com (Public)
- **LAN**: https://expense-manager-lan.onrender.com (Internal API)
- **Database**: PostgreSQL on Render

Users cÃ³ thá»ƒ truy cáº­p tá»« má»i máº¡ng!
