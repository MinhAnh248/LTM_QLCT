# ğŸš€ Setup Render - HÆ°á»›ng dáº«n tá»«ng bÆ°á»›c

## âœ… BÆ°á»›c 1: WAN Service (ÄÃƒ XONG)
- URL: https://expense-manager-wan.onrender.com
- Status: âœ… Live

---

## ğŸ“¦ BÆ°á»›c 2: Táº¡o PostgreSQL Database

### TrÃªn Render Dashboard:
1. Click **"New +"** â†’ **"PostgreSQL"**
2. Äiá»n thÃ´ng tin:
   ```
   Name: expense-db
   Database: expense_manager
   User: expense_user
   Region: Singapore
   Plan: Free
   ```
3. Click **"Create Database"**
4. Äá»£i 1-2 phÃºt Ä‘á»ƒ database khá»Ÿi táº¡o
5. Copy **Internal Database URL** (dáº¡ng: `postgresql://user:pass@host/db`)

---

## ğŸ”§ BÆ°á»›c 3: Táº¡o LAN Service

### TrÃªn Render Dashboard:
1. Click **"New +"** â†’ **"Web Service"**
2. Connect GitHub repository: `MinhAnh248/LTM_QLCT`
3. Äiá»n thÃ´ng tin:

```yaml
Name: expense-manager-lan
Environment: Python 3
Region: Singapore
Branch: main

Build Command:
cd LAN && pip install -r requirements.txt

Start Command:
cd LAN && python app.py
```

4. **Environment Variables** - Click "Add Environment Variable":

```bash
# Copy tá»« WAN service (pháº£i giá»‘ng nhau)
INTERNAL_SECRET=<copy-from-WAN>

# Generate má»›i
ADMIN_SECRET=<generate-random-32-chars>

# Copy tá»« PostgreSQL database
DATABASE_URL=<paste-internal-database-url>

# Fixed
FLASK_ENV=production
PORT=10000
```

5. Click **"Create Web Service"**
6. Äá»£i deploy xong (3-5 phÃºt)

---

## ğŸ”— BÆ°á»›c 4: Cáº­p nháº­t WAN Environment Variables

### TrÃªn WAN Service Settings:
1. VÃ o **expense-manager-wan** â†’ **Environment**
2. ThÃªm/Cáº­p nháº­t:

```bash
# URL cá»§a LAN service vá»«a táº¡o
LAN_API_URL=https://expense-manager-lan.onrender.com

# Copy tá»« PostgreSQL
DATABASE_URL=<paste-internal-database-url>
```

3. Click **"Save Changes"**
4. WAN sáº½ tá»± Ä‘á»™ng redeploy

---

## ğŸ—„ï¸ BÆ°á»›c 5: Khá»Ÿi táº¡o Database

### Sau khi cáº£ WAN vÃ  LAN Ä‘á»u live:

```bash
# Láº¥y ADMIN_SECRET tá»« LAN environment variables
# Gá»i API khá»Ÿi táº¡o database
curl -X POST https://expense-manager-lan.onrender.com/init_db \
  -H "Admin-Secret: YOUR_ADMIN_SECRET_HERE"
```

**Káº¿t quáº£ mong Ä‘á»£i:**
```json
{"success": true, "message": "Database initialized"}
```

---

## âœ… BÆ°á»›c 6: Test há»‡ thá»‘ng

### Test 1: Health checks
```bash
# WAN
curl https://expense-manager-wan.onrender.com/health

# LAN
curl https://expense-manager-lan.onrender.com/health
```

### Test 2: ÄÄƒng kÃ½ user
```bash
curl -X POST https://expense-manager-wan.onrender.com/register \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "123456"}'
```

### Test 3: ÄÄƒng nháº­p
```bash
curl -X POST https://expense-manager-wan.onrender.com/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "123456"}'
```

### Test 4: Truy cáº­p web
Má»Ÿ browser: https://expense-manager-wan.onrender.com

---

## ğŸ“‹ Checklist hoÃ n thÃ nh

- [x] WAN Service deployed
- [ ] PostgreSQL Database created
- [ ] LAN Service deployed
- [ ] Environment variables configured
- [ ] Database initialized
- [ ] System tested

---

## ğŸ”‘ Environment Variables Summary

### WAN Service:
```bash
FLASK_ENV=production
SECRET_KEY=<auto-generated>
INTERNAL_SECRET=<must-match-LAN>
LAN_API_URL=https://expense-manager-lan.onrender.com
DATABASE_URL=<from-postgres>
```

### LAN Service:
```bash
FLASK_ENV=production
INTERNAL_SECRET=<must-match-WAN>
ADMIN_SECRET=<generate-new>
DATABASE_URL=<from-postgres>
PORT=10000
```

---

## ğŸš¨ Troubleshooting

### LAN khÃ´ng start Ä‘Æ°á»£c:
- Kiá»ƒm tra DATABASE_URL Ä‘Ãºng format
- Kiá»ƒm tra requirements.txt cÃ³ psycopg2-binary
- Xem logs: LAN service â†’ Logs tab

### WAN khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c LAN:
- Kiá»ƒm tra LAN_API_URL Ä‘Ãºng
- Kiá»ƒm tra INTERNAL_SECRET giá»‘ng nhau
- Test LAN health: `curl https://expense-manager-lan.onrender.com/health`

### Database connection error:
- Kiá»ƒm tra DATABASE_URL format: `postgresql://user:pass@host:5432/db`
- Äáº£m báº£o dÃ¹ng Internal Database URL (khÃ´ng pháº£i External)
- Kiá»ƒm tra database Ä‘Ã£ khá»Ÿi táº¡o xong

---

## ğŸ‰ Káº¿t quáº£

Sau khi hoÃ n thÃ nh:
- **WAN**: https://expense-manager-wan.onrender.com (Public)
- **LAN**: https://expense-manager-lan.onrender.com (Internal API)
- **Database**: PostgreSQL on Render

Users cÃ³ thá»ƒ truy cáº­p tá»« má»i máº¡ng!
